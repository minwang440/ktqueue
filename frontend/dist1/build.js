webpackJsonp([0],{14:function(e,t){function o(e,t){var o=e[1]||"",n=e[3];if(!n)return o;if(t&&"function"==typeof btoa){var i=a(n);return[o].concat(n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"})).concat([i]).join("\n")}return[o].join("\n")}function a(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a=o(t,e);return t[2]?"@media "+t[2]+"{"+a+"}":a}).join("")},t.i=function(e,o){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},n=0;n<this.length;n++){var i=this[n][0];"number"==typeof i&&(a[i]=!0)}for(n=0;n<e.length;n++){var s=e[n];"number"==typeof s[0]&&a[s[0]]||(o&&!s[2]?s[2]=o:o&&(s[2]="("+s[2]+") and ("+o+")"),t.push(s))}},t}},15:function(e,t,o){function a(e){for(var t=0;t<e.length;t++){var o=e[t],a=c[o.id];if(a){a.refs++;for(var n=0;n<a.parts.length;n++)a.parts[n](o.parts[n]);for(;n<o.parts.length;n++)a.parts.push(i(o.parts[n]));a.parts.length>o.parts.length&&(a.parts.length=o.parts.length)}else{for(var s=[],n=0;n<o.parts.length;n++)s.push(i(o.parts[n]));c[o.id]={id:o.id,refs:1,parts:s}}}}function n(){var e=document.createElement("style");return e.type="text/css",d.appendChild(e),e}function i(e){var t,o,a=document.querySelector("style["+v+'~="'+e.id+'"]');if(a){if(f)return h;a.parentNode.removeChild(a)}if(g){var i=m++;a=p||(p=n()),t=s.bind(null,a,i,!1),o=s.bind(null,a,i,!0)}else a=n(),t=r.bind(null,a),o=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else o()}}function s(e,t,o,a){var n=o?"":a.css;if(e.styleSheet)e.styleSheet.cssText=_(t,n);else{var i=document.createTextNode(n),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}function r(e,t){var o=t.css,a=t.media,n=t.sourceMap;if(a&&e.setAttribute("media",a),b.ssrId&&e.setAttribute(v,t.id),n&&(o+="\n/*# sourceURL="+n.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var l="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!l)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=o(273),c={},d=l&&(document.head||document.getElementsByTagName("head")[0]),p=null,m=0,f=!1,h=function(){},b=null,v="data-vue-ssr-id",g="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());e.exports=function(e,t,o,n){f=o,b=n||{};var i=u(e,t);return a(i),function(t){for(var o=[],n=0;n<i.length;n++){var s=i[n],r=c[s.id];r.refs--,o.push(r)}t?(i=u(e,t),a(i)):i=[];for(var n=0;n<o.length;n++){var r=o[n];if(0===r.refs){for(var l=0;l<r.parts.length;l++)r.parts[l]();delete c[r.id]}}}};var _=function(){var e=[];return function(t,o){return e[t]=o,e.filter(Boolean).join("\n")}}()},16:function(e,t){e.exports=function(e,t,o,a,n){var i,s=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(i=e,s=e.default);var l="function"==typeof s?s.options:s;t&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns),a&&(l._scopeId=a);var u;if(n?(u=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},l._ssrRegister=u):o&&(u=o),u){var c=l.functional,d=c?l.render:l.beforeCreate;c?l.render=function(e,t){return u.call(t),d(e,t)}:l.beforeCreate=d?[].concat(d,u):[u]}return{esModule:i,exports:s,options:l}}},190:function(e,t,o){"use strict";o.d(t,"a",function(){return a});var a={name:"",node:null,gpuNum:0,command:"",image:"",repo:"",branch:"",commit:"",comments:"",volumeMounts:[],cpuLimit:"1.5",memoryLimit:"2Gi",autoRestart:!1}},191:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(3),n=o(48),i=o(49),s=o(50),r=o(28),l=o.n(r),u=o(269),c=(o.n(u),o(270)),d=o.n(c),p=o(276),m=o.n(p),f=o(288),h=o.n(f),b=o(293),v=o.n(b),g=o(298),_=o.n(g);a.default.use(l.a),a.default.use(i.default),a.default.use(s.default),a.default.use(n.default);var y=[{path:"/",name:"jobs",redirect:"/jobs",meta:{requireAuth:!0}},{path:"/jobs",component:m.a,meta:{requireAuth:!0}},{path:"/jobs/:jobName/log",component:h.a,meta:{requireAuth:!0}},{path:"/repos",name:"repos",component:v.a,meta:{requireAuth:!0}},{path:"/login",name:"login",component:_.a,meta:{requireAuth:!1}}],w=new i.default({routes:y}),x=new n.default.Store({strict:!1,state:{userInfo:{username:window.localStorage.username}},mutations:{updateUserInfo:function(e,t){e.userInfo=t}}});w.beforeEach(function(e,t,o){e.meta.requireAuth&&null==x.state.userInfo.username?o({path:"/login"}):o()}),new a.default({router:w,store:x,el:"#app",render:function(e){return e(d.a)},created:function(){var e=this;this.$http.get("/api/current_user").then(function(t){e.$store.commit("updateUserInfo",{username:t.body.user}),window.localStorage.username=t.body.user,"/login"===e.$route.path&&e.$router.push("/")}).catch(function(t){e.$store.commit("updateUserInfo",{username:null}),delete window.localStorage.username})}})},269:function(e,t){},270:function(e,t,o){function a(e){o(271)}var n=o(16)(o(274),o(275),a,null,null);e.exports=n.exports},271:function(e,t,o){var a=o(272);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("1bf11e26",a,!0,{})},272:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,"#tq-title{vertical-align:middle;line-height:60px;float:left;margin:0 2em 0 1em}",""])},273:function(e,t){e.exports=function(e,t){for(var o=[],a={},n=0;n<t.length;n++){var i=t[n],s=i[0],r=i[1],l=i[2],u=i[3],c={id:e+":"+n,css:r,media:l,sourceMap:u};a[s]?a[s].parts.push(c):o.push(a[s]={id:s,parts:[c]})}return o}},274:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"app",data:function(){return{}},mounted:function(){},methods:{logout:function(){var e=this;this.$http.delete("./api/current_user",this.form).then(function(t){e.$store.commit("updateUserInfo",{username:null}),delete window.localStorage.username,e.$message.success("Successful logout"),e.$router.replace("/login")}).catch(function(t){e.$message.errr("Can not logout"),console.error(t.body)})}}}},275:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("div",{attrs:{id:"tq-header"}}),e._v(" "),o("el-menu",{attrs:{"default-active":e.$route.path,mode:"horizontal",router:!0}},[o("h2",{attrs:{id:"tq-title"}},[e._v("KTQueue")]),e._v(" "),o("el-menu-item",{attrs:{index:"/jobs",route:{path:"/jobs"}}},[e._v("Jobs")]),e._v(" "),o("el-menu-item",{attrs:{index:"/repos",route:{path:"/repos"}}},[e._v("Repos")]),e._v(" "),e.$store.state.userInfo.username?o("el-submenu",{attrs:{index:"currentUser"}},[o("template",{slot:"title"},[e._v(e._s(e.$store.state.userInfo.username))]),e._v(" "),o("el-menu-item",{attrs:{index:"logout",route:{}},on:{click:e.logout}},[e._v("Logout")])],2):o("el-menu-item",{attrs:{index:"login",route:{}}},[o("a",{attrs:{href:"/auth/oauth2/start"}},[e._v("Login")])])],1),e._v(" "),o("router-view")],1)},staticRenderFns:[]}},276:function(e,t,o){function a(e){o(277)}var n=o(16)(o(279),o(287),a,null,null);e.exports=n.exports},277:function(e,t,o){var a=o(278);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("b32620ea",a,!0,{})},278:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,".table-header{padding:.5em 0}.table-header .el-pagination{display:inline-block}.table-header .el-button,.table-header .el-pagination,.table-header .el-radio-group{vertical-align:middle}.inline-form-span{width:1em;height:1em;float:left}.job-expand-item{margin-bottom:10px;overflow:hidden;zoom:1}.job-expand-item>div{margin-left:100px}.job-expand-item>div>pre{margin:0;white-space:pre-wrap}.job-expand-item>label{width:100px;float:left;text-align:right;padding-right:1em;box-sizing:border-box}.job-expand-item .el-tag+.el-tag{margin-left:1em}.job-expand-item .el-button{padding:0}.status-stop-wrap{display:inline-block;width:32px}.el-table .positive-row{background:#e2f0e4}",""])},279:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),n=o.n(a),i=o(28),s=(o.n(i),o(282)),r=o.n(s),l=o(190);t.default={components:{JobEditDialog:r.a},data:function(){var e={jobsFilter:"All",page:1,pageSize:20,user:null,node:null},t=function(e){return e?Array.isArray(e)?e:[e]:e};return{loading:null,defaultFilter:e,jobsFilter:this.$route.query.jobsFilter||e.jobsFilter,jobsFilterUser:t(this.$route.query.user)||e.jobsFilterUser,jobsFilterNode:t(this.$route.query.node)||e.jobsFilterNode,pageSizeToGo:parseInt(this.$route.query.pageSize||e.pageSize),jobsData:{count:0,pageSize:parseInt(this.$route.query.pageSize||e.pageSize),page:parseInt(this.$route.query.page||e.page),data:[]},editJobDialog:{visible:!1,title:"Create Job",data:Object.assign({},l.a),disabledFields:{},type:"create"},repos:[],nodes:[]}},mounted:function(){var e=this;this.loadJobs(this.jobsData.page,this.jobsData.pageSize),this.$http.get("./api/repos?pageSize=0&repo_only=1").then(function(t){for(var o=0;o<t.body.data.length;o++)e.repos.push({value:t.body.data[o].repo})}),this.$http.get("./api/nodes").then(function(t){e.nodes=t.body.items})},methods:{moment:n.a,showCreateJob:function(){this.editJobDialog.title="Create job",this.editJobDialog.disabledFields={},this.editJobDialog.type="create",this.editJobDialog.visible=!0},showCloneJob:function(e,t){this.editJobDialog.title="Clone job",this.editJobDialog.disabledFields={},this.editJobDialog.type="clone";var o=t[e];this.editJobDialog.data=Object.assign({},o),this.editJobDialog.visible=!0},showEditJob:function(e,t){this.editJobDialog.title="Edit job",this.editJobDialog.disabledFields={name:!0,repo:!0,branch:!0,commit:!0,cpuLimit:!0,memoryLimit:!0,autoRestart:!0},this.editJobDialog.type="edit";var o=t[e];if("ManualStop"!==o.status&&"Completed"!==o.status)for(var a=["node","gpuNum","image","command","volumeMounts"],n=0;n<a.length;n++){var i=a[n];this.editJobDialog.disabledFields[i]=!0}this.editJobDialog.data=Object.assign({},o),this.editJobDialog.visible=!0},stopJob:function(e,t){var o=this,a=t[e].name;this.$confirm("Do you really want to stop "+a+"?","Stop job",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(function(){o.$http.post("./api/job/stop/"+a,{}).then(function(e){o.$message({type:"success",message:a+" stopped!"}),o.loadJobs(o.jobsData.page),o.editJobDialog.visible=!1})}).catch(function(){o.$message({type:"info",message:"Cancel."})})},restartJob:function(e,t){var o=this,a=t[e].name;this.$confirm("Do you really want to Restart "+a+"?","Restart job",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(function(){o.$http.post("./api/job/restart/"+a,{}).then(function(e){o.$message({type:"success",message:a+" Restarted!"}),o.loadJobs(o.jobsData.page),o.editJobDialog.visible=!1})}).catch(function(){o.$message({type:"info",message:"Cancel."})})},startBoard:function(e,t){var o=this,a=t[e];this.$prompt("Please enter logdir. You can use $JOB_NAME, $WORK_DIR, $OUTPUT_DIR","TensorBoard",{confirmButtonText:"Confirm",cancelButtonText:"Cancel"}).then(function(e){o.$http.post("./api/job/tensorboard/"+a.name,{logdir:e.value}).then(function(){o.loadJobs(o.jobsData.page)})}).catch(function(){})},stopBoard:function(e,t){var o=this,a=t[e];this.$http.delete("./api/job/tensorboard/"+a.name).then(function(){o.loadJobs(o.jobsData.page),o.$message({type:"info",message:"TensorBoard stopped."})}).catch(function(e){o.loadJobs(o.jobsData.page),o.$message.error(e.body),console.error(e.body)})},pageCurrentChange:function(e){this.jobsData.pageSize===this.pageSizeToGo&&this.loadJobs(e,this.jobsData.pageSize)},pageSizeChange:function(e){this.pageSizeToGo=e,this.loadJobs(Math.floor((this.jobsData.page-1)*this.jobsData.pageSize/e)+1,e)},loadJobs:function(e,t){var o=this;t=t||this.jobsData.pageSize,this.loading=i.Loading.service({target:this.$refs.rootdiv});var a={};a.page=e,"Hidden"===this.jobsFilter?a.hide="1":"Fav"===this.jobsFilter?a.fav="1":"Running"===this.jobsFilter&&(a.status="$RunningExtra",a.hide="all"),this.jobsFilterUser&&(a.user=this.jobsFilterUser),this.jobsFilterNode&&(a.node=this.jobsFilterNode),a.pageSize=t;var n={jobsFilter:this.jobsFilter,user:this.jobsFilterUser,node:this.jobsFilterNode,page:e,pageSize:t};for(var s in n)n[s]===this.defaultFilter[s]&&delete n[s];this.$router.push({query:n}),this.$http.get("./api/jobs",{params:a}).then(function(e){o.loading&&o.loading.close(),o.jobsData=e.body})},onConfirmEdit:function(e){var t=this;if("edit"===this.editJobDialog.type){var o={_id:e._id,comments:e.comments};if("ManualStop"===e.status||"Completed"===e.status)for(var a=["node","gpuNum","image","command","volumeMounts"],n=0;n<a.length;n++){var i=a[n];o[i]=e[i]}return void this.$http.put("./api/jobs",o).then(function(){t.loadJobs(t.jobsData.page),t.editJobDialog.visible=!1}).catch(function(e){t.$message.error(e.body),console.error(e.body)})}this.$http.post("./api/jobs",e).then(function(e){t.loadJobs(1),t.editJobDialog.visible=!1}).catch(function(e){t.$message.error(e.body),console.error(e.body)})},jobHideChange:function(e,t){return this.$http.put("./api/jobs",{_id:e._id,hide:t}).then(function(){e.hide=t}).catch(function(){e.hide=!t}),!t},toggleFavorite:function(e,t){var o=t.target;"I"!==o.tagName&&(o=o.querySelector("i")),o.className="el-icon-loading",this.$http.put("./api/jobs",{_id:e._id,fav:!e.fav}).then(function(){e.fav=!e.fav}).catch(function(){})},jobsFilterChange:function(e){console.log(e),void 0!==e.user&&(e.user.length?this.jobsFilterUser=e.user:this.jobsFilterUser=null),void 0!==e.node&&(e.node.length?this.jobsFilterNode=e.node:this.jobsFilterNode=null),this.loadJobs(this.jobsData.page)},tableRowClassName:function(e,t){return"Running"===e.status?"positive-row":""}},computed:{filterUsers:function(){var e=[];return this.$store.state.userInfo.username&&e.push({text:this.$store.state.userInfo.username,value:this.$store.state.userInfo.username}),e},filterNodes:function(){var e=[],t=!0,o=!1,a=void 0;try{for(var n,i=this.nodes[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var s=n.value;e.push({text:s.name,value:s.name})}}catch(e){o=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(o)throw a}}return e}}}},282:function(e,t,o){function a(e){o(283)}var n=o(16)(o(285),o(286),a,null,null);e.exports=n.exports},283:function(e,t,o){var a=o(284);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("77761bd4",a,!0,{})},284:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,".el-form-item.inline-item{margin-right:1em;display:inline-block}",""])},285:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(190);t.default={name:"job-edit-dialog",props:{nodes:{type:Array,default:[]},repos:{type:Array,default:[]},show:Boolean,title:{type:String,default:"Edit job"},data:{type:Object,default:function(){return Object.assign({},a.a)}},disabledFields:{type:Object,default:function(){return{}}}},data:function(){return{internalData:Object.assign({},a.a)}},watch:{data:function(e){this.internalData=Object.assign({},e)}},methods:{addVolumeMount:function(){this.data.volumeMounts.push({hostPath:"",mountPath:"",key:Date.now()})},removeVolume:function(e){var t=this.data.volumeMounts.indexOf(e);-1!==t&&this.data.volumeMounts.splice(t,1)},repoQuerySearch:function(e,t){var o=this.repos,a=e?o.filter(this.createFilter(e)):o;console.log(a),t(a)},createFilter:function(e){return function(t){return-1!==t.value.indexOf(e.toLowerCase())}}}}},286:function(e,t){e.exports={render:function(){var e=this,t=this,o=t.$createElement,a=t._self._c||o;return a("el-dialog",{attrs:{title:t.title,visible:t.show,size:"large"},on:{"update:visible":function(e){t.show=e},close:function(){return e.$emit("cancel")}}},[a("el-form",{ref:"form",attrs:{model:t.internalData,"label-width":"95px"}},[a("el-form-item",{attrs:{label:"Name",required:""}},[a("el-input",{attrs:{disabled:t.disabledFields.name},model:{value:t.internalData.name,callback:function(e){t.$set(t.internalData,"name",e)},expression:"internalData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Node"}},[a("el-select",{attrs:{clearable:"",placeholder:"Any",disabled:t.disabledFields.node},model:{value:t.internalData.node,callback:function(e){t.$set(t.internalData,"node",e)},expression:"internalData.node"}},t._l(t.nodes,function(e){return a("el-option",{key:e.labels["kubernetes.io/hostname"],attrs:{label:e.labels["kubernetes.io/hostname"]+" ("+(e.gpu_capacity-e.gpu_used)+"/"+e.gpu_capacity+")",value:e.labels["kubernetes.io/hostname"]}})})),t._v(" "),a("label",[t._v(" (avail/total) ")])],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"GPUs"}},[a("el-input-number",{attrs:{disabled:t.disabledFields.gpuNum},model:{value:t.internalData.gpuNum,callback:function(e){t.$set(t.internalData,"gpuNum",e)},expression:"internalData.gpuNum"}})],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"MemoryLimit"}},[a("el-input",{attrs:{disabled:t.disabledFields.memoryLimit,placeholder:"NoLimit"},model:{value:t.internalData.memoryLimit,callback:function(e){t.$set(t.internalData,"memoryLimit",e)},expression:"internalData.memoryLimit"}})],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"CPULimit"}},[a("el-input",{attrs:{disabled:t.disabledFields.cpuLimit,placeholder:"NoLimit"},model:{value:t.internalData.cpuLimit,callback:function(e){t.$set(t.internalData,"cpuLimit",e)},expression:"internalData.cpuLimit"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Command",required:""}},[a("el-input",{attrs:{type:"textarea",rows:3,disabled:t.disabledFields.command},model:{value:t.internalData.command,callback:function(e){t.$set(t.internalData,"command",e)},expression:"internalData.command"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Image",required:""}},[a("el-input",{attrs:{disabled:t.disabledFields.image},model:{value:t.internalData.image,callback:function(e){t.$set(t.internalData,"image",e)},expression:"internalData.image"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Repo"}},[a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.repoQuerySearch,disabled:t.disabledFields.repo},model:{value:t.internalData.repo,callback:function(e){t.$set(t.internalData,"repo",e)},expression:"internalData.repo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Branch"}},[a("el-input",{attrs:{disabled:t.disabledFields.branch},model:{value:t.internalData.branch,callback:function(e){t.$set(t.internalData,"branch",e)},expression:"internalData.branch"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Commit"}},[a("el-input",{attrs:{disabled:t.disabledFields.commit},model:{value:t.internalData.commit,callback:function(e){t.$set(t.internalData,"commit",e)},expression:"internalData.commit"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Comments"}},[a("el-input",{attrs:{type:"textarea",rows:3,disabled:t.disabledFields.comments},model:{value:t.internalData.comments,callback:function(e){t.$set(t.internalData,"comments",e)},expression:"internalData.comments"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Auto Restart"}},[a("el-checkbox",{attrs:{disabled:t.disabledFields.autoRestart},model:{value:t.internalData.autoRestart,callback:function(e){t.$set(t.internalData,"autoRestart",e)},expression:"internalData.autoRestart"}})],1),t._v(" "),t._l(t.internalData.volumeMounts,function(e,o){return a("el-form-item",{key:e.key,attrs:{label:"Volume",rules:{required:!0,message:"volumeMounts should not be empty",trigger:"blur"}}},[a("el-col",{attrs:{span:10}},[a("el-form-item",[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"hostPath",disabled:t.disabledFields.volumeMounts},model:{value:e.hostPath,callback:function(o){t.$set(e,"hostPath",o)},expression:"volume.hostPath"}})],1)],1),t._v(" "),a("span",{staticClass:"inline-form-span"}),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"mountPath",disabled:t.disabledFields.volumeMounts},model:{value:e.mountPath,callback:function(o){t.$set(e,"mountPath",o)},expression:"volume.mountPath"}})],1)],1),t._v(" "),a("span",{staticClass:"inline-form-span"}),t._v(" "),a("el-button",{attrs:{disabled:t.disabledFields.volumeMounts},on:{click:function(o){o.preventDefault(),t.removeVolume(e)}}},[t._v("Delete")])],1)}),t._v(" "),a("el-form-item",[a("el-button",{attrs:{disabled:t.disabledFields.volumeMounts},on:{click:t.addVolumeMount}},[t._v("Add volumeMounts")])],1)],2),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(){return e.$emit("cancel")}}},[t._v("Cancel")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(){return e.$emit("confirm",e.internalData)}}},[t._v("Confirm")])],1)],1)},staticRenderFns:[]}},287:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{ref:"rootdiv"},[o("div",{staticClass:"table-header"},[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showCreateJob}},[e._v("Create Job")]),e._v(" "),o("el-radio-group",{attrs:{size:"small"},on:{change:e.jobsFilterChange},model:{value:e.jobsFilter,callback:function(t){e.jobsFilter=t},expression:"jobsFilter"}},[o("el-radio-button",{attrs:{label:"All"}}),e._v(" "),o("el-radio-button",{attrs:{label:"Hidden"}}),e._v(" "),o("el-radio-button",{attrs:{label:"Fav"}}),e._v(" "),o("el-radio-button",{attrs:{label:"Running"}})],1),e._v(" "),o("el-pagination",{attrs:{layout:"prev, pager, next, sizes","page-size":e.jobsData.pageSize,total:e.jobsData.total,"current-page":e.jobsData.page},on:{"current-change":e.pageCurrentChange,"size-change":e.pageSizeChange}})],1),e._v(" "),o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.jobsData.data,"row-class-name":e.tableRowClassName},on:{"filter-change":e.jobsFilterChange}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"job-expand-item"},[o("label",[e._v("name: ")]),o("div",[e._v(e._s(t.row.name))])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("repo: ")]),o("div",[e._v(e._s(t.row.repo))])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("branch: ")]),o("div",[e._v(e._s(t.row.branch))])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("commit: ")]),o("div",[e._v(e._s(t.row.commit))])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("command: ")]),o("div",[e._v(e._s(t.row.command))])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("comments: ")]),o("div",[o("pre",[e._v(e._s(t.row.comments))])])]),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("Edit: ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.showEditJob(t.$index,e.jobsData.data)}}},[e._v("Edit")])],1),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("Clone: ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.showCloneJob(t.$index,e.jobsData.data)}}},[e._v("Clone")])],1),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("Control: ")]),e._v(" "),-1!=t.row.status.indexOf("Completed")||"ManualStop"==t.row.status||"FetchError"==t.row.status?o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.restartJob(t.$index,e.jobsData.data)}}},[e._v("Restart")]):o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.stopJob(t.$index,e.jobsData.data)}}},[e._v("Stop")])],1),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("TensorBoard: ")]),e._v(" "),t.row.tensorboard?o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.stopBoard(t.$index,e.jobsData.data)}}},[e._v("Stop")]):o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.startBoard(t.$index,e.jobsData.data)}}},[e._v("Start")])],1),e._v(" "),o("div",{staticClass:"job-expand-item"},[o("label",[e._v("Hide: ")]),e._v(" "),o("div",[o("el-switch",{attrs:{width:70,"on-text":"Hide","off-text":"Show",disabled:"Completed"!=t.row.status&&"ManualStop"!=t.row.status&&"FetchError"!=t.row.status},on:{change:function(o){e.jobHideChange(t.row,o)}},model:{value:t.row.hide,callback:function(o){e.$set(t.row,"hide",o)},expression:"scope.row.hide"}})],1)]),e._v(" "),t.row.tensorboard?o("p",[o("a",{attrs:{href:"/tensorboard/"+t.row.name+"/"}},[e._v("TensorBoard")])]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.toggleFavorite(t.row,o)}}},[t.row.fav?o("i",{staticClass:"el-icon-star-on"}):o("i",{staticClass:"el-icon-star-off"})])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:"name","show-overflow-tooltip":!0}}),e._v(" "),o("el-table-column",{attrs:{label:"Node",width:"100",prop:"runningNode",filters:e.filterNodes,columnKey:"node","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.runningNode||"")+"\n      ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"status",prop:"status",width:"120","header-align":"left","show-overflow-tooltip":!0}}),e._v(" "),o("el-table-column",{attrs:{prop:"gpuNum",label:"GPUs",width:"80",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{label:"creation",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{attrs:{title:e.moment(t.row.creationTimestamp).fromNow()}},[e._v(e._s(t.row.creationTimestamp?e.moment(t.row.creationTimestamp).format("YYYY-MM-DD HH:mm:SS"):""))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"user",label:"user",width:"110","show-overflow-tooltip":!0,filters:e.filterUsers,columnKey:"user",align:"left"}}),e._v(" "),o("el-table-column",{attrs:{label:"Log",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("router-link",{attrs:{to:{path:"/jobs/"+t.row.name+"/log"}}},[o("el-button",{attrs:{type:"text",size:"small"}},[e._v("Log")])],1)]}}])})],1),e._v(" "),o("job-edit-dialog",{attrs:{title:e.editJobDialog.title,nodes:e.nodes,repos:e.repos,show:e.editJobDialog.visible,data:e.editJobDialog.data,"disabled-fields":e.editJobDialog.disabledFields},on:{confirm:e.onConfirmEdit,cancel:function(){return e.editJobDialog.visible=!1}}})],1)},staticRenderFns:[]}},288:function(e,t,o){function a(e){o(289)}var n=o(16)(o(291),o(292),a,null,null);e.exports=n.exports},289:function(e,t,o){var a=o(290);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("00fcbaba",a,!0,{})},290:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,".ktq-log-wrap{white-space:pre-wrap}.new-log-text{background-color:#d3dce6}.follow-switch{position:fixed;top:100px;right:60px}",""])},291:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={template:"#tq-job-log-template",data:function(){return{logText:"",newLogText:"",selectedVersion:null,versions:[],lineWrap:!1,wscon:null,follow:!1}},mounted:function(){this.loadJobLogVersions(this.$route.params.jobName)},beforeDestroy:function(){this.stopWebSocketFollow()},methods:{loadJobLog:function(e,t){if(null!==t){var o=this.$loading({target:".ktq-log-text",text:"loading log"});this.$http.get("./api/jobs/"+e+"/log/"+t).then(function(e){this.logText=e.body,this.newLogText="",o.close()}).catch(function(e){this.$message.error("Unable to load Log!\n"),console.error(e.body),o.close()})}},loadJobLogVersions:function(e){this.$http.get("./api/jobs/"+e+"/log/version").then(function(e){return this.versions=e.body.versions,0===this.versions.length?void(this.selectedVersion=null):this.$route.query.version?void(this.selectedVersion=this.$route.query.version):void(-1!==this.versions.indexOf("current")?this.selectedVersion="current":this.selectedVersion=this.versions[this.versions.length-1])}).catch(function(e){this.$message.error("Unable to load Log versions!\n"),console.error(e.body)})},versionChange:function(e){this.$router.replace({query:{version:e}}),"current"===e?(this.follow=!0,this.startWebSocketFollow(this.$route.params.jobName)):(this.stopWebSocketFollow(),this.loadJobLog(this.$route.params.jobName,e))},followChange:function(e){e?this.startWebSocketFollow(this.$route.params.jobName):(this.stopWebSocketFollow(),this.loadJobLog(this.$route.params.jobName,this.selectedVersion))},startWebSocketFollow:function(e){var t=this;this.stopWebSocketFollow();var o=window.location.protocol.startsWith("https")?"wss://":"ws://",a=new WebSocket(o+window.location.host+"/wsapi/jobs/"+e+"/log?tailLines=1000");a.onmessage=function(e){t.logText+=t.newLogText;var o=t.logText.length-51200;o>0&&(t.logText=t.logText.slice(o+1)),t.newLogText=e.data};var n=function(e){t.$notify({title:"Log follow is stopped",message:"Please refresh this page.",duration:0,type:"error"}),console.error(e),t.wscon=null};a.onerror=n,a.onclose=function(e){e.code>1e3&&n(e)},this.wscon=a,this.logText="",this.newLogText="",this.wsclosing=!1},stopWebSocketFollow:function(){this.wscon&&(this.wscon.close(1e3),this.wscon=null)}}}},292:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-select",{attrs:{placeholder:""},on:{change:e.versionChange},model:{value:e.selectedVersion,callback:function(t){e.selectedVersion=t},expression:"selectedVersion"}},e._l(e.versions,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})})),e._v(" "),o("el-switch",{attrs:{width:90,"on-text":"Wrap","off-text":"No wrap"},model:{value:e.lineWrap,callback:function(t){e.lineWrap=t},expression:"lineWrap"}}),e._v(" "),"current"==e.selectedVersion?o("el-switch",{staticClass:"follow-switch",attrs:{"on-text":"Follow","off-text":"Static",width:100},on:{change:e.followChange},model:{value:e.follow,callback:function(t){e.follow=t},expression:"follow"}}):e._e(),e._v(" "),o("a",{attrs:{download:this.$route.params.jobName+"."+this.$route.query.version+".txt",href:"api/jobs/"+this.$route.params.jobName+"/log/"+this.$route.query.version}},[o("el-button",{attrs:{type:"text"}},[e._v("Download")])],1),e._v(" "),o("pre",{staticClass:"ktq-log-text",class:{"ktq-log-wrap":e.lineWrap}},[e._v(e._s(e.logText)),o("span",{staticClass:"new-log-text"},[e._v(e._s(e.newLogText))])])],1)},staticRenderFns:[]}},293:function(e,t,o){function a(e){o(294)}var n=o(16)(o(296),o(297),a,null,null);e.exports=n.exports},294:function(e,t,o){var a=o(295);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("26e7abf2",a,!0,{})},295:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,".el-form-item .el-radio-group{vertical-align:middle}",""])},296:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={template:"#tq-repos-template",props:{},data:function(){return{reposData:{count:0,pageSize:20,page:1,loading:!1,data:[]},createRepoDialog:{visible:!1,title:"Create Repo",sshKey:"",username:"",password:"",data:{repo:"",authType:"ssh_key",credential:{}}}}},mounted:function(){this.loadRepos(1)},methods:{loadRepos:function(e){this.reposData.loading=!0,this.$http.get("./api/repos?page="+e).then(function(e){e.body.loading=!1,this.reposData=e.body})},createRepo:function(){switch(this.createRepoDialog.data.authType){case"https_password":this.createRepoDialog.data.credential={username:this.createRepoDialog.username,password:this.createRepoDialog.password};break;case"ssh_key":this.createRepoDialog.data.credential={sshKey:this.createRepoDialog.sshKey}}this.$http.post("./api/repos",this.createRepoDialog.data).then(function(e){this.loadRepos(1),this.createRepoDialog.visible=!1})},handleDelete:function(e){var t=this;this.$confirm("Do you really want to Delete "+e.repo+"?","Delete Repo",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(function(){t.$http.delete("/api/repos/"+e._id).then(function(e){t.loadRepos(1)}).catch(function(e){t.$message.error(e.body),console.error(e.body)})})}}}},297:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"table-header"},[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.createRepoDialog.visible=!0}}},[e._v("Create Repo")]),e._v(" "),o("el-pagination",{attrs:{layout:"prev, pager, next","page-size":e.reposData.pageSize,total:e.reposData.total},on:{"current-change":e.loadRepos}})],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.reposData.loading,expression:"reposData.loading"}],staticStyle:{width:"100%"},attrs:{data:e.reposData.data}},[o("el-table-column",{attrs:{prop:"repo",label:"repo","show-overflow-tooltip":!0}}),e._v(" "),o("el-table-column",{attrs:{label:"Action",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(o){e.handleDelete(t.row)}}},[e._v("Delete")])]}}])})],1),e._v(" "),o("el-dialog",{attrs:{title:e.createRepoDialog.title,size:"large"},model:{value:e.createRepoDialog.visible,callback:function(t){e.$set(e.createRepoDialog,"visible",t)},expression:"createRepoDialog.visible"}},[o("el-form",{ref:"form",attrs:{model:e.createRepoDialog.data,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"Repo"}},[o("el-input",{model:{value:e.createRepoDialog.data.repo,callback:function(t){e.$set(e.createRepoDialog.data,"repo",t)},expression:"createRepoDialog.data.repo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Auth"}},[o("el-radio-group",{model:{value:e.createRepoDialog.data.authType,callback:function(t){e.$set(e.createRepoDialog.data,"authType",t)},expression:"createRepoDialog.data.authType"}},[o("el-radio-button",{attrs:{label:"ssh_key"}},[e._v("SSH-key")]),e._v(" "),o("el-radio-button",{attrs:{label:"https_password"}},[e._v("HTTPS password")])],1)],1),e._v(" "),"ssh_key"==e.createRepoDialog.data.authType?o("el-form-item",{attrs:{label:"SSH Key"}},[o("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.createRepoDialog.sshKey,callback:function(t){e.$set(e.createRepoDialog,"sshKey",t)},expression:"createRepoDialog.sshKey"}})],1):e._e(),e._v(" "),"https_password"==e.createRepoDialog.data.authType?o("el-form-item",{attrs:{label:"Username"}},[o("el-input",{model:{value:e.createRepoDialog.username,callback:function(t){e.$set(e.createRepoDialog,"username",t)},expression:"createRepoDialog.username"}})],1):e._e(),e._v(" "),"https_password"==e.createRepoDialog.data.authType?o("el-form-item",{attrs:{label:"Password"}},[o("el-input",{attrs:{type:"password"},model:{value:e.createRepoDialog.password,callback:function(t){e.$set(e.createRepoDialog,"password",t)},expression:"createRepoDialog.password"}})],1):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.createRepoDialog.visible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.createRepo}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]}},298:function(e,t,o){function a(e){o(299)}var n=o(16)(o(301),o(302),a,null,null);e.exports=n.exports},299:function(e,t,o){var a=o(300);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(15)("ab9aefa2",a,!0,{})},300:function(e,t,o){t=e.exports=o(14)(!1),t.push([e.i,".login-form{margin:10px auto;padding:10px 80px;text-align:center;width:200px;border:1px solid #ccc;border-radius:10px;background-color:#eee}",""])},301:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"app",data:function(){return{}},mounted:function(){this.$store.state.userInfo.username&&this.$router.replace("/")}}},302:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"login-form"},[o("p",[o("a",{attrs:{href:"./auth/oauth2/start"}},[o("el-button",{attrs:{type:"primary"}},[e._v("Login")])],1)])])},staticRenderFns:[]}}},[191]);
//# sourceMappingURL=build.js.map